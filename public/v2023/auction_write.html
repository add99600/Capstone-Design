<html lang="농밀">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="theme-color" content="#712cf9">
    <title>농밀</title>
    <link rel="stylesheet" type="text/css" href="../../static/css/newcom-style.css">
    <link rel="stylesheet" type="text/css" href="../../static/css/board-css.css">
    <link rel="canonical" href="https://getbootstrap.kr/docs/5.2/examples/carousel/">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
     <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>
<body>

<main>
    <div class="position-relative overflow-hidden p-3 p-md-5 m-md-3 text-center"
         style="font-size: 1.4rem; background-image: url('static/img/san.png'); width : auto; height: 400px">
        <header class="p-3 text" style="font-size: 1.4rem; background-color:transparent;">
                <div class="container">
                    <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">

                        <a href="/static" class="d-flex align-items-center mb-2 mb-lg-0 text-black text-decoration-none">
                            <svg class="bi me-2" width="40" height="32" role="img" aria-label="Bootstrap"><use xlink:href="#bootstrap"></use></svg>
                        </a>

                        <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
                            <li><a href="http://127.0.0.1:8000" class="nav-link px-2 text-white">홈</a></li>
                            <li><a href="#" class="nav-link px-2 text-white">안내</a></li>
                            <li><a href="#" class="nav-link px-2 text-white">공지사항</a></li>
                            <li><a href="market.html" class="nav-link px-2 text-white">직거래</a></li>
                            <li><a href="freeboard.html" class="nav-link px-2 text-white">커뮤니티</a></li>
                        </ul>

                        <form class="col-12 col-lg-auto mb-3 mb-lg-0 me-lg-3" role="search">
                            <input type="search" class="form-control form-control-dark text-bg-light" placeholder="Search..." aria-label="Search">
                        </form>

                        <div class="text-end">
                            <button type="button" class="btn btn-outline-light me-2" onClick="location.href='login.html'">로그인</button>
                            <button type="button" class="btn btn-warning" onClick="location.href='jtm.html'">회원가입</button>
                        </div>
                    </div>
                </div>
            </header>
        <div class="col-md-5 p-lg-5 mx-auto my-5" style="float: right">
            <h1 class="display-4 fw-normal text-white" style="text-align: left">따뜻한 공사</h1>
            <h1 class="display-4 fw-normal text-white" style="text-align: left">합리적인 공사</h1>
            <h1 class="display-4 fw-normal text-white" style="text-align: left">공사 진행중 입니다</h1>
            <p class="lead fw-normal text-white" style="text-align: left">현재 여기는 새로운 ui를 위해 공사중 입니다.</p>
            <a class="btn btn-outline-secondary" style="text-align: left" href="#">Coming soon</a>
        </div>
    </div>
    <!-- 위는 네비 아래는 큰 이미지 예정-->
    <div style=" z-index: 2; background: #818182">
        <div class="sidebar">
            <ul>
                <h2 style="text-align: center; padding : 10px">사이드 메뉴</h2>
                <li><a href="#">공지사항</a></li>
                <li><a href="market.html">직거래</a></li>
                <li><a href="auction.html">경매장</a></li>
                <li><a href="freeboard.html">자유게시판</a></li>
            </ul>
        </div>
    </div>
    <div class="container marketing" style="padding-top: 50px">

        <!-- Three columns of text below the carousel -->
         <div class="row featurette" style="height: 1000px">

             <section id="main">
                 <article id="article1">
                     <div class="board_wrap">
                         <div class="board_title">
                             <strong>경매 등록</strong>
                             <p>경매 물품을 등록하세요</p>
                         </div>
                         <div class="board_write_wrap">
                             <div class="board_write">
                                 <div class="title">
                                     <dl>
                                         <dt>제목</dt>
                                         <dd><input type="text" placeholder="제목 입력" id="title"></dd>
                                     </dl>
                                 </div>
                                 <div class="info">
                                     <dl style="text-align: left">
                                         <dt>바로 구매가</dt>
                                         <dd><input type="text" placeholder="가격 입력" id="nowprice"></dd>
                                     </dl>
                                     <dl>
                                         <dt>입찰가</dt>
                                         <dd><input type="text" placeholder="가격 입력" id="price"></dd>
                                     </dl>
                                 </div>
                                 <div class="info">
                                     <dl>
                                         <dt>날짜 설정</dt>
                                         <dd><input style="padding: 10px" type="date" name="dateInput" id="outdate"></dd>
                                     </dl>
                                     <dl>
                                         <dt>시간 설정</dt>
                                         <dd><input style="padding: 10px" type="time" name="timeInput" id="outtime"></dd>
                                     </dl>
                                 </div>
                                 <div class="info">
                                     <dl>
                                         <form>
                                             <dt>사진 선택</dt>
                                             <dd>
                                                 <input class="form-control" style="font-size: 1.4rem" type="file" id="image" onchange="previewImage(event)"></dd>
                                             <br>
                                             <dl style="padding-top: 10px">
                                                 <img width="200px" height="100px" id="preview" src="#" alt="이미지 미리보기">
                                             </dl>
                                         </form>
                                     </dl>
                                 </div>
                             </div>
                             <div class="bt_wrap">
                                 <a><button class="on" id="send">등록</button></a>
                                 <a href="market.html">취소</a>
                             </div>
                         </div>
                     </div>
                 </article>
             </section>
         </div>
    </div>
     <hr class="featurette-divider">
    <div class="footer">
        <h3>&nbsp;&nbsp;&nbsp;프로젝트 이름</h3>
        <p>
            &nbsp;호서 대학교
            &nbsp;컴퓨터 공학부&nbsp;
            &nbsp;웹 하자(WebDo) 팀: ㅇㅎㅈ, ㅅㅎㅈ&nbsp;
            &nbsp;이메일 : 추가@바람.com&nbsp;
            &nbsp;&nbsp;&nbsp;&nbsp;&Copyright 2023, All Right Reserved.&nbsp;</spam>
        </p>
    </div>
</main>
</body>


<script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>
<script>

    const priceInput = document.querySelector('#price');
    priceInput.addEventListener('input', function (event) {
      const value = event.target.value.replace(/,/g, ''); // 기존에 입력된 쉼표 제거
      const regex = /\B(?=(\d{3})+(?!\d))/g;
      event.target.value = value.replace(regex, ','); // 3자리마다 쉼표 추가
    });

    const ipriceInput = document.querySelector('#nowprice');
    ipriceInput.addEventListener('input', function (event) {
      const value = event.target.value.replace(/,/g, ''); // 기존에 입력된 쉼표 제거
      const regex = /\B(?=(\d{3})+(?!\d))/g;
      event.target.value = value.replace(regex, ','); // 3자리마다 쉼표 추가
    });

    var firebaseConfig = {
        apiKey: "AIzaSyCunQjLi23bBAybA97IFMaIrXUwuJSV8mM",
        authDomain: "wepdo-7bed1.firebaseapp.com",
        databaseURL: "https://wepdo-7bed1-default-rtdb.firebaseio.com",
        projectId: "wepdo-7bed1",
        storageBucket: "wepdo-7bed1.appspot.com",
        messagingSenderId: "204948006692",
        appId: "1:204948006692:web:bbb863d7032ddbbf64b5b1",
        measurementId: "G-7NQSDSFC61"
    };
    firebase.initializeApp(firebaseConfig);

    const db = firebase.firestore();
    const storage = firebase.storage();

    var my_name = JSON.parse(localStorage.getItem('user')).displayName;
    var user_name;

    db.collection('user').where('name', '==', my_name).get().then((querySnapshot) => {
      querySnapshot.forEach((doc) => {
        user_name = doc.data().name;
        console.log(user_name);
      });
    }).catch((error) => {
      console.log('Error getting documents: ', error);
    });



    $('#send').click(function () {

        var file = document.querySelector('#image').files[0];
        var storageRef = storage.ref();
        var save_img = null;
        var upload_img = null;
        var url = null;

        const auth = firebase.auth();
        const user = auth.currentUser;

        if (file) {
            save_img = storageRef.child('/image/' + file.name);
            upload_img = save_img.put(file)
            upload_img.on('state_change',
                null,
                (error) => {
                    console.error('실패',error);
                },
                () => {
                    upload_img.snapshot.ref.getDownloadURL().then((downloadURL) => {
                        url = downloadURL;
                        console.log('업로드된 경로',url)

                        var today = new Date();
                        var month = today.getMonth() + 1;
                        var day = today.getDate();

                        var img = {
                            제목: $('#title').val(),
                            즉구: $('#nowprice').val(),
                            현재가: $('#price').val(),
                            날짜: month + "월 " + day + "일",
                            uid: user.uid,
                            이미지: url,
                            name: user_name,
                            od: $('#outdate').val(),
                            ot: $('#outtime').val()
                        }
                        db.collection('auction').add(img)
                            .then((result) => {
                                console.log(result)
                            }).catch((error) => {
                            console.log(error)
                        })
                    });
                }
            )
        } else {
            alert("빠진 내용이 있습니다");
        }
    });

</script>
</html>