<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="theme-color" content="#712cf9">
    <title>농밀</title>
    <link rel="stylesheet" type="text/css" href="../../static/css/newcom-style.css">
    <link rel="stylesheet" type="text/css" href="../../static/css/board-css.css">
    <link rel="canonical" href="https://getbootstrap.kr/docs/5.2/examples/carousel/">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>
<body>

<main>
    <div class="position-relative overflow-hidden p-3 p-md-5 m-md-3 text-center"
         style="font-size: 1.4rem; background-image: url('/img/san.png'); width : auto; height: 400px">
        <header class="p-3 text" style="font-size: 1.4rem; background-color:transparent;">
            <div class="container">
                <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">

                    <a href="/static" class="d-flex align-items-center mb-2 mb-lg-0 text-black text-decoration-none">
                        <svg class="bi me-2" width="40" height="32" role="img" aria-label="Bootstrap"><use xlink:href="#bootstrap"></use></svg>
                    </a>

                    <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
                        <li><a href="http://127.0.0.1:8000" class="nav-link px-2 text-white">홈</a></li>
                        <li><a href="#" class="nav-link px-2 text-white">안내</a></li>
                        <li><a href="#" class="nav-link px-2 text-white">공지사항</a></li>
                        <li><a href="market.html" class="nav-link px-2 text-white">직거래</a></li>
                        <li><a href="freeboard.html" class="nav-link px-2 text-white">커뮤니티</a></li>
                    </ul>

                    <form class="col-12 col-lg-auto mb-3 mb-lg-0 me-lg-3" role="search">
                        <input type="search" class="form-control form-control-dark text-bg-light" placeholder="Search..." aria-label="Search">
                    </form>

                    <div class="text-end">
                        <button type="button" class="btn btn-outline-light me-2" onClick="location.href='login.html'">로그인</button>
                        <button type="button" class="btn btn-warning" onClick="location.href='jtm.html'">회원가입</button>
                    </div>
                </div>
            </div>
        </header>
        <div class="col-md-5 p-lg-5 mx-auto my-5" style="float: right">
            <h1 class="display-4 fw-normal text-white" style="text-align: left">따뜻한 공사</h1>
            <h1 class="display-4 fw-normal text-white" style="text-align: left">합리적인 공사</h1>
            <h1 class="display-4 fw-normal text-white" style="text-align: left">공사 진행중 입니다</h1>
            <p class="lead fw-normal text-white" style="text-align: left">현재 여기는 새로운 ui를 위해 공사중 입니다.</p>
            <a class="btn btn-outline-secondary" style="text-align: left" href="#">Coming soon</a>
        </div>
    </div>
    <!-- 위는 네비 아래는 큰 이미지 예정-->
    <div style=" z-index: 2; background: #818182">
        <div class="sidebar">
            <ul>
                <h2 style="text-align: center; padding : 10px">사이드 메뉴</h2>
                <li><a href="#">공지사항</a></li>
                <li><a href="market.html">직거래</a></li>
                <li><a href="auction.html">경매장</a></li>
                <li><a href="freeboard.html">자유게시판</a></li>
            </ul>
        </div>
    </div>
    <div class="container marketing" style="padding-top: 50px">
        <!-- Three columns of text below the carousel -->
        <div class="row featurette" style="height: auto">
            <section id="main">
                <article id="article1">
                    <div class="board_wrap">
                        <div class="board_title">
                            <strong>거래게시판</strong>
                             <p>알잘딱</p>
                        </div>
                        <div class="board_view_wrap">
                            <div class="board_view">
                                <div class="title"></div>
                                  <div class="info">
                                    <dl>
                                      <dt>번호</dt>
                                      <dd>5</dd>
                                    </dl>
                                    <dl>
                                      <dt>가격</dt>
                                      <dd class="price"></dd>
                                    </dl>
                                    <dl>
                                      <dt>작성일</dt>
                                      <dd class="date"></dd>
                                    </dl>
                                    <dl>
                                      <dt>조회</dt>
                                      <dd>67</dd>
                                    </dl>
                                  </div>
                                  <img class="detail-pic" style="padding : 20px; border-radius: 12px; height: 20vw; width:20vw">
                                <div class="content" style="font-size: 1.6rem; line-height: 140%; padding: 10px;"></div>
                            </div>
                            <div class="bt_wrap">
                                <a><button href="market.html" class="on" id="send">등록</button></a>
                                <a><button href="m_edit.html" id="ed">수정</button></a>
                                <a><button href="m_edit.html" id="chat">채팅</button></a>
                            </div>
                        </div>
                    </div>
                </article>
            </section>
        </div>
    </div>
    <div class="footer">
        <h3>&nbsp;&nbsp;&nbsp;프로젝트 이름</h3>
        <p>
            &nbsp;호서 대학교
            &nbsp;컴퓨터 공학부&nbsp;
            &nbsp;웹 하자(WebDo) 팀: ㅇㅎㅈ, ㅅㅎㅈ&nbsp;
            &nbsp;이메일 : 추가@바람.com&nbsp;
            &nbsp;&nbsp;&nbsp;&nbsp;&Copyright 2023, All Right Reserved.&nbsp;</spam>
        </p>
    </div>
</main>
<script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>

<script>
    var firebaseConfig = {
    apiKey: "AIzaSyCunQjLi23bBAybA97IFMaIrXUwuJSV8mM",
    authDomain: "wepdo-7bed1.firebaseapp.com",
    databaseURL: "https://wepdo-7bed1-default-rtdb.firebaseio.com",
    projectId: "wepdo-7bed1",
    storageBucket: "wepdo-7bed1.appspot.com",
    messagingSenderId: "204948006692",
    appId: "1:204948006692:web:bbb863d7032ddbbf64b5b1",
    measurementId: "G-7NQSDSFC61"
    };
    firebase.initializeApp(firebaseConfig);

    var today = new Date();
    var month = today.getMonth() + 1;
    var day = today.getDate();

    const db = firebase.firestore();
    const storage = firebase.storage();

    var bring = new URLSearchParams(window.location.search);

    var seller_uid
    var item_name
    var seller_name

    db.collection('post').doc(bring.get('id')).get().then((result) => {
      seller_uid = result.data().uid;
      item_name = result.data().제목;
      seller_name = result.data().name;
      console.log(result.data())
      $('.title').html(result.data().제목)
      $('.price').html(result.data().가격)
      $('.date').html(result.data().날짜)
      $('.content').html(result.data().내용)
      $('.detail-pic').attr('src', result.data().이미지);
    });

    //채팅방 생성시 내거 상대거
    var my_uid = JSON.parse(localStorage.getItem('user')).uid

    $('#chat').click(function(){
        var chat_data = {
            who : [my_uid, seller_uid].sort(), //내 uid, 판매자 uid를 정렬한 배열
            product : item_name,
            date: month + "월 " + day + "일",
            name: seller_name

        }

        // who 필드를 정렬한 후 문자열로 변환
        const chat_id = chat_data.who.join('');

        db.collection('chat').doc(chat_id).get().then((doc) => {
            if (doc.exists) { // 이미 해당 채팅방이 존재하는 경우
                window.location.href = 'chat.html?id=' + bring.get('id');
            } else { // 새로운 채팅방을 생성하는 경우
                db.collection('chat').doc(chat_id).set(chat_data).then(() => {
                    console.log("채팅방이 생성되었습니다.");
                    window.location.href = 'chat.html?id=' + bring.get('id');
                }).catch((error) => {
                    console.error(error)
                });
            }
        }).catch((error) => {
            console.error(error);
        });
    });

    $('#ed').click(function(){ // 수정 게시판으로 가기
        window.location.href = 'http://127.0.0.1:8000/m_edit.html?id=' + bring.get('id');
    });
</script>
</body>
</html>